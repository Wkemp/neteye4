To be able to setup endpoint Monitoring of AX Etw Tracing and SQL DMV Monitor following prerequisits must be fullfilled:
1) Neteye 4.16
2) setup and configured Nats service on neteye 
3) setup and configured Tornado and Tornado nats collector services on neteye master
4) installed AX Etw Traxing and SQLDMV Monitor  version 0.5 or higher
5) installed and configured Zampat repository (please refer to https://github.com/zampat/neteye4/blob/master/doc/050_community_configs_init.md) on the neteye master
Note: Zampat repository is required as configuration is based on the Host template generic-passive-host and Service template generic-passive-service

define topic name to use for nats communication

<agent_monitor_alive.topic> = name which must be configured on nats.server and on axetwtracind and sqldmvmonitor


Configuration of neteye Icinga Directory Objects for EndPoint monitor

a) Create Data Fields (dummy_text and dummy_state) 
b) Create Command (keepalive_check and monitordata_check)
c) Create Service templates (generic_keepalive_service and generic_monitordata_service)


Configuration of nats user and permissions 

Define permission for ax and sql agents on nats server

create conf file  agents-nats-json-publisher.conf /neteye/shared/nats-server/conf/permissions.d:

  AGENT_MONITOR_ALIVE_METRICS = {
    publish = "tornado_nats_json.>"
  }

Define user for ax and sql agents on nats server

create conf file /neteye/shared/nats-server/conf/users.d:
  {user: "agents.pele.dev", permissions: $AGENT_MONITOR_ALIVE_METRICS}


Configuration of tornado json collector 

To be able to listen and consume events of the agent keepalive and monitordata the defined topic <agent_monitor_alive.topic> must be configured in 
/neteye/shared/tornado_nats_json_collector/topics path: 

Create file  <topic>.json file:
{
  "nats_topics": [<agent_monitor_alive.topic>],
  "collector_config": {
    "event_type": "${event_type}",
    "payload": {
      "header": "${header}",
      "body": "${body}"
    }
  }
}

In this file nats topics are defined (nats_topic can be changed). Defines transformation rule for messages sent from agents to tornado syntax (leave this part without changes) 

The tornado group must have read rights on <topic>.json 

Chown tornado <topic>.json 

Chgrp tornado <topic>.json 

Chmod g+r-x <topic>.json 

Chmod +rw <topic>.json 

Chmod o-xrw <topic>.json 

 
Restart the service 

systemctl restart tornado_nats_json_collector.service 

Check service tornado_nats_json_collector  is up and running 

systemctl status tornado_nats_json_collector.service 


Configuration of Tornado rules and filters for Agents using Tornado UI



